{{- /* Theme Toggle Switch - æœ€ç»ˆå½¢æ€Â·æ—¥é£Ÿå…‰åœˆç‰ˆ (Solar Eclipse Aperture) */ -}}
<header class="header">
    <nav class="nav">
        <div class="logo">
            {{- $label_text := (site.Params.label.text | default site.Title) -}}
            <a href="{{ "" | absLangURL }}" accesskey="h" title="{{ $label_text }} (Alt + H)">
                {{- if site.Params.label.icon }}
                {{- $img := resources.Get site.Params.label.icon }}
                {{- if $img }}
                    {{- $img := $img.Resize "35x35" }}
                    <img src="{{ $img.Permalink }}" alt="" aria-label="logo"
                        height="{{ $img.Height }}" width="{{ $img.Width }}">
                {{- else }}
                <img src="{{ site.Params.label.icon | absURL }}" alt="" aria-label="logo"
                    height="35" width="35">
                {{- end -}}
                {{- end -}}
                {{- $label_text -}}
            </a>
            <div class="logo-switches">
                {{- if (not site.Params.disableThemeToggle) }}
                
                <!-- ================================================== -->
                <!-- CSS æ ¸å¿ƒï¼šåœ†å½¢å‰ªè£è·Ÿéš + ç›¸äº¤å˜è‰² -->
                <!-- ================================================== -->
                <style>
                    /* 0. ç‰©ç†ç¼“åŠ¨æ›²çº¿ (Fluid Physics) */
                    :root {
                        /* è¿™ç§æ›²çº¿æ¨¡æ‹Ÿæ¶²ä½“çš„æµåŠ¨æ„Ÿï¼Œéå¸¸é¡ºæ»‘ */
                        --fluid-bezier: cubic-bezier(0.4, 0.0, 0.2, 1);
                        --bounce-bezier: cubic-bezier(0.68, -0.55, 0.265, 1.55);
                    }

                    /* 1. å®¹å™¨ (è§†çª—) */
                    button#theme-toggle {
                        position: relative;
                        width: 80px !important;
                        height: 40px !important;
                        border-radius: 99px !important;
                        padding: 0 !important;
                        margin-left: 12px;
                        cursor: pointer;
                        overflow: hidden;
                        
                        top: 3px !important; /* ä½ç½®å¾®è°ƒ */
                        
                        display: inline-flex !important;
                        align-items: center;
                        z-index: 100;
                        
                        /* ç»ç’ƒè´¨æ„Ÿè¾¹æ¡† */
                        border: 3px solid rgba(255, 255, 255, 0.5) !important;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.1), inset 0 2px 4px rgba(0,0,0,0.05);
                        
                        /* é»˜è®¤èƒŒæ™¯ (åº•å±‚ - ç™½å¤©) */
                        background: linear-gradient(135deg, #70F5FF 0%, #4FACFE 100%) !important;
                        
                        -webkit-tap-highlight-color: transparent;
                        outline: none;
                    }

                    /* éšè—æ—§ SVG */
                    button#theme-toggle svg { display: none !important; }


                    /* 2. é»‘å¤œå…‰åœˆ (The Aperture) - æ ¸å¿ƒé­”æ³• */
                    .night-aperture {
                        position: absolute;
                        top: 0; left: 0; width: 100%; height: 100%;
                        z-index: 2;
                        pointer-events: none;
                        
                        /* é»‘å¤œèƒŒæ™¯ï¼šæ·±ç©ºç´« */
                        background: linear-gradient(135deg, #120c34 0%, #24243e 100%);
                        
                        /* ã€å…³é”®ã€‘åˆå§‹çŠ¶æ€ï¼šå…‰åœˆåŠå¾„ä¸º0ï¼Œåœ†å¿ƒåœ¨å·¦ä¾§ (å¤ªé˜³ä½ç½®) */
                        /* è¿™é‡Œçš„ 20px æ˜¯å·¦ä¾§çƒå¿ƒçš„ä½ç½® */
                        clip-path: circle(0px at 20px 50%);
                        
                        /* åŠ¨ç”»ï¼šåœ†çš„å¤§å°å’Œåœ†å¿ƒçš„ä½ç½®åŒæ—¶å˜åŒ– */
                        transition: clip-path 0.7s var(--fluid-bezier);
                    }


                    /* 3. è£…é¥°å…ƒç´  (èƒŒæ™¯é‡Œçš„äº‘å’Œæ˜Ÿæ˜Ÿ) */
                    .clouds-container, .stars-container {
                        position: absolute;
                        top: 0; left: 0; width: 100%; height: 100%;
                    }
                    
                    /* äº‘æœµ (åœ¨åº•å±‚) */
                    .clouds-container { z-index: 1; }
                    .cloud {
                        position: absolute; background: rgba(255,255,255,0.85); border-radius: 10px;
                        animation: float 3s infinite ease-in-out;
                    }
                    .c1 { top: 12px; left: 40px; width: 20px; height: 10px; }
                    .c1::after { content:''; position:absolute; top:-5px; right:4px; width:10px; height:10px; background:inherit; border-radius:50%;}
                    .c2 { top: 24px; left: 55px; width: 14px; height: 7px; opacity:0.8; animation-delay: 1s;}

                    /* æ˜Ÿæ˜Ÿ (åœ¨é»‘å¤œå…‰åœˆé‡Œ) */
                    .stars-container { z-index: 3; }
                    .star {
                        position: absolute; background: #fff; border-radius: 50%;
                        box-shadow: 0 0 4px #fff; opacity: 1;
                        animation: twinkle 2s infinite ease-in-out;
                    }
                    .s1 { top: 10px; left: 15px; width: 2px; height: 2px; }
                    .s2 { top: 25px; left: 30px; width: 3px; height: 3px; animation-delay: 0.5s; }
                    .s3 { top: 15px; left: 45px; width: 1px; height: 1px; animation-delay: 1s; }


                    /* 4. æ—¥é£Ÿæ»‘å— (Eclipse Handler) - è§†è§‰ç„¦ç‚¹ */
                    .toggle-handler {
                        position: absolute;
                        top: 3px; left: 3px; /* 3px padding */
                        width: 28px; height: 28px; /* çƒä½“å°ºå¯¸ */
                        border-radius: 50%;
                        z-index: 10;
                        pointer-events: none;
                        
                        /* è¿™æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œç”¨æ¥è£å‰ªå†…éƒ¨çš„å¤ªé˜³å’Œæœˆäº® */
                        overflow: hidden;
                        box-shadow: 2px 2px 8px rgba(0,0,0,0.25);
                        
                        /* ä½ç§»å’Œæ—‹è½¬ */
                        transition: transform 0.7s var(--fluid-bezier);
                        transform: translateX(0) rotate(0deg);
                    }

                    /* 5. å¤ªé˜³å®ä½“ */
                    .sun-core {
                        position: absolute;
                        top: 0; left: 0; width: 100%; height: 100%;
                        background: radial-gradient(circle at 30% 30%, #fff59d 0%, #ffcc00 100%);
                        transition: transform 0.7s var(--fluid-bezier);
                        transform: translateX(0); /* é»˜è®¤æ˜¾ç¤º */
                    }

                    /* 6. æœˆäº®å®ä½“ (é®ç½©ä½“) */
                    .moon-core {
                        position: absolute;
                        top: 0; left: 0; width: 100%; height: 100%;
                        background: radial-gradient(circle at 30% 30%, #ece9e6 0%, #9fa8da 100%);
                        
                        /* åˆå§‹ä½ç½®ï¼šç§»å‡ºè§†é‡ (åœ¨å¤ªé˜³å³è¾¹) */
                        transform: translateX(100%); 
                        transition: transform 0.7s var(--fluid-bezier);
                    }
                    
                    /* é™¨çŸ³å‘ç»†èŠ‚ */
                    .crater { position: absolute; background: rgba(0,0,0,0.15); border-radius: 50%; }
                    .cr1 { top: 6px; left: 8px; width: 6px; height: 6px; }
                    .cr2 { top: 16px; left: 16px; width: 4px; height: 4px; }
                    .cr3 { top: 18px; left: 6px; width: 3px; height: 3px; }

                    /* åŠ¨ç”»å…³é”®å¸§ */
                    @keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-2px);} }
                    @keyframes twinkle { 0%,100%{opacity:1;transform:scale(1);} 50%{opacity:0.5;transform:scale(0.6);} }


                    /* =========================================
                       ğŸš€ çŠ¶æ€æ¿€æ´» (Body Dark)
                       ========================================= */
                    
                    /* 1. è¾¹æ¡†å¾®è°ƒ */
                    body.dark button#theme-toggle {
                        border-color: rgba(255, 255, 255, 0.2) !important;
                    }

                    /* 2. é»‘å¤œå…‰åœˆï¼šæ‰©æ•£ */
                    body.dark .night-aperture {
                        /* åŠå¾„å˜å¤§ (è¦†ç›–æ•´ä¸ªæŒ‰é’®)ï¼Œåœ†å¿ƒç§»åŠ¨åˆ°å³ä¾§ (60px) */
                        /* 60px = æŒ‰é’®å®½80 - çƒåŠå¾„14 - è¾¹è· */
                        clip-path: circle(100px at 60px 50%);
                    }

                    /* 3. æ»‘å—æ•´ä½“ï¼šå‘å³æ»šåŠ¨ */
                    body.dark .toggle-handler {
                        /* ç§»åŠ¨ 40px (80 - 28 - 6 - 6) */
                        transform: translateX(40px) rotate(360deg);
                    }

                    /* 4. å†…éƒ¨æ—¥é£ŸåŠ¨ç”» (Eclipse Logic) */
                    /* å½“çƒä½“å‘å³æ»šæ—¶ï¼Œå¤ªé˜³å‘å·¦ç§»å‡ºï¼Œæœˆäº®ä»å³ç§»å…¥ */
                    /* åœ¨ä¸­é—´æ—¶ï¼Œä¸¤è€…é‡å ï¼Œå½¢æˆæ—¥é£Ÿ */
                    
                    body.dark .sun-core {
                        transform: translateX(-100%); /* å¤ªé˜³æ»šèµ° */
                    }
                    body.dark .moon-core {
                        transform: translateX(0); /* æœˆäº®å½’ä½ */
                    }

                </style>

                <!-- æŒ‰é’®ç»“æ„ -->
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    
                    <!-- åº•å±‚ï¼šç™½å¤©è£…é¥° (æ°¸è¿œæ˜¾ç¤ºï¼Œè¢«é»‘å¤œè¦†ç›–) -->
                    <div class="clouds-container">
                        <div class="cloud c1"></div>
                        <div class="cloud c2"></div>
                    </div>

                    <!-- é¡¶å±‚ï¼šé»‘å¤œå…‰åœˆ (é€šè¿‡ clip-path æ‰©æ•£) -->
                    <div class="night-aperture">
                        <div class="stars-container">
                            <div class="star s1"></div>
                            <div class="star s2"></div>
                            <div class="star s3"></div>
                        </div>
                    </div>

                    <!-- æ ¸å¿ƒæ»‘å— -->
                    <span class="toggle-handler">
                        <!-- å¤ªé˜³å®ä½“ -->
                        <div class="sun-core"></div>
                        <!-- æœˆäº®å®ä½“ (è´Ÿè´£é®æŒ¡å¤ªé˜³) -->
                        <div class="moon-core">
                            <span class="crater cr1"></span>
                            <span class="crater cr2"></span>
                            <span class="crater cr3"></span>
                        </div>
                    </span>

                    <!-- SVG å ä½ -->
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                </button>

                <!-- JS é€»è¾‘ -->
                <script>
                    (function() {
                        const originalBtn = document.getElementById("theme-toggle");
                        if (!originalBtn) return;

                        const newBtn = originalBtn.cloneNode(true);
                        originalBtn.parentNode.replaceChild(newBtn, originalBtn);

                        function setDark(isDark) {
                            if (isDark) {
                                document.body.classList.add('dark');
                                document.documentElement.classList.add('dark');
                                localStorage.setItem('pref-theme', 'dark');
                            } else {
                                document.body.classList.remove('dark');
                                document.documentElement.classList.remove('dark');
                                localStorage.setItem('pref-theme', 'light');
                            }
                        }

                        newBtn.addEventListener("click", function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            const isCurrentlyDark = document.body.classList.contains('dark') || 
                                                  document.documentElement.classList.contains('dark');
                            setDark(!isCurrentlyDark);
                        });

                        const savedTheme = localStorage.getItem('pref-theme');
                        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                        if (savedTheme === 'dark' || (!savedTheme && systemDark)) {
                            setDark(true);
                        } else {
                            setDark(false);
                        }
                    })();
                </script>

                {{- end }}
                {{- $lang := .Lang}}
                {{- $separator := or $label_text (not site.Params.disableThemeToggle)}}
                {{- with site.Home.AllTranslations }}
                <ul class="lang-switch">
                    {{- if $separator }}<li>|</li>{{ end }}
                    {{- range . -}}
                    {{- if ne $lang .Lang }}
                    <li>
                        <a href="{{- .Permalink -}}" title="{{ .Language.Params.languageAltTitle | default (.Language.LanguageName | emojify) | default (.Lang | title) }}"
                            aria-label="{{ .Language.LanguageName | default (.Lang | title) }}">
                            {{- if (and site.Params.displayFullLangName (.Language.LanguageName)) }}
                            {{- .Language.LanguageName | emojify -}}
                            {{- else }}
                            {{- .Lang | title -}}
                            {{- end -}}
                        </a>
                    </li>
                    {{- end -}}
                    {{- end}}
                </ul>
                {{- end }}
            </div>
        </div>
        {{- $currentPage := . }}
        <ul id="menu">
            {{- range site.Menus.main }}
            {{- $menu_item_url := (cond (strings.HasSuffix .URL "/") .URL (printf "%s/" .URL) ) | absLangURL }}
            {{- $page_url:= $currentPage.Permalink | absLangURL }}
            {{- $is_search := eq (site.GetPage .KeyName).Layout "search" }}
            <li>
                <a href="{{ .URL | absLangURL }}" title="{{ .Title | default .Name }} {{- cond $is_search " (Alt + /)" "" }}"
                {{- if $is_search -}}accesskey="/"{{- end -}}>
                    <span {{- if eq $menu_item_url $page_url }} class="active" {{- end }}>
                        {{- .Pre }}
                        {{- .Name -}}
                        {{- .Post -}}
                    </span>
                    {{- if (findRE "://" .URL) }}&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                    {{- end }}
                </a>
            </li>
            {{- end }}
        </ul>
    </nav>
</header>